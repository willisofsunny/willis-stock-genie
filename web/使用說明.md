# FinGenius Web 介面使用說明

## 📖 功能概覽

FinGenius Web 介面提供了一個直觀的網頁操作平台，讓您可以通過瀏覽器輕鬆進行台股 AI 分析。系統整合了完整的 **Research-Battle 雙環架構**，提供從數據研究到專家辯論的一站式分析服務。

## 🎯 核心功能

### 1. 股票代碼輸入與驗證

**輸入格式**：台股代碼（4-6位數字）

**操作步驟**：
1. 在輸入框中輸入股票代碼（如：2330）
2. 點擊「驗證」按鈕查詢股票基本資訊
3. 系統會即時顯示股票名稱和產業分類

**常用股票代碼**：
| 代碼 | 公司名稱 | 產業 |
|------|---------|------|
| 2330 | 台積電 | 半導體 |
| 2317 | 鴻海 | 電子零組件 |
| 2454 | 聯發科 | 半導體 |
| 2881 | 富邦金 | 金融保險 |
| 2882 | 國泰金 | 金融保險 |
| 2412 | 中華電 | 通信網路 |

### 2. 完整三階段 AI 分析

系統會自動執行完整的分析流程，包含：

#### 🔍 **Research 階段**（研究階段）
6 位專業 AI 分析師依序進行深度分析：

| 分析師 | 專長領域 | 分析內容 |
|--------|----------|----------|
| **輿情分析師** | 市場情緒 | 市場情緒、熱門話題、資金流向 |
| **風險評估師** | 風險控制 | 政策風險、財務風險、法務風險 |
| **三大法人分析師** | 機構動向 | 外資、投信、自營商買賣超分析 |
| **技術分析師** | 技術指標 | K線、RSI、MACD、布林通道等 |
| **籌碼分析師** | 籌碼集中度 | 主力動向、散戶行為分析 |
| **大額交易分析師** | 大單監控 | 大單異動、成交量分析 |

#### ⚔️ **Battle 階段**（辯論階段）
- 基於研究結果進行多輪結構化辯論
- 每位專家發表看多/看空觀點
- 專家之間針對關鍵問題進行討論
- 最終投票決定市場預測（看多/看空）

#### 📄 **Report 生成**（報告生成）
- **HTML 美化報告**：包含圖表、辯論記錄、投票統計
- **辯論 JSON**：完整的辯論對話記錄
- **投票 JSON**：投票結果與統計數據
- 所有報告自動保存到 `report/` 目錄

### 3. 即時進度顯示

分析過程中，您可以看到：
- ✅ 每位分析師的工作狀態（等待中 → 分析中 → 完成）
- 📊 整體分析進度條
- 🔄 當前執行的階段（Research/Battle/Report）
- ⏱️ 預計完成時間
- ❌ 取消分析按鈕（可隨時中止）

### 4. 多維度分析結果展示

分析完成後，可通過以下標籤頁查看結果：

#### **總覽**
- 股票基本資訊（代碼、名稱、產業、最新價格）
- AI 綜合評估（看漲/看空、綜合評分）
- 主要利多與注意風險

#### **技術分析**
- 互動式 K 線圖表
- 技術指標走勢（RSI、MACD、布林通道）
- 趨勢評估與支撐壓力位

#### **三大法人**
- 外資、投信、自營商買賣超統計
- 法人持股比例變化
- 視覺化圖表展示

#### **籌碼分析**
- 籌碼集中度分析
- 主力/散戶持股分佈
- 籌碼穩定性評估

#### **輿情分析**
- 市場整體情感（正面/負面/中性）
- 熱度評級
- 關鍵話題與討論焦點

#### **風險評估**
- 風險等級評定
- 主要風險因素識別
- 風險控制建議

#### **辯論結果** 🆕
- **最終決策**：AI 專家集體投票結果
- **投票統計**：看多/看空票數分佈
- **決策理由**：基於辯論的關鍵論點

## 🚀 啟動方式

### 方法一：啟動 Web 服務器（推薦）

```bash
cd /Users/xuwillis/Documents/FinGenius/web
python3 server.py
```

服務器啟動後，您會看到：
```
🚀 啟動 FinGenius 台股分析平台 Web 服務器
📱 前端訪問地址: http://localhost:8000
🔌 WebSocket 端點: ws://localhost:8000/ws/{client_id}
按 Ctrl+C 停止服務器
```

然後在瀏覽器中訪問：`http://localhost:8000`

### 方法二：直接打開 HTML 文件（不推薦）

```bash
open /Users/xuwillis/Documents/FinGenius/web/index.html
```

**⚠️ 注意**：直接打開 HTML 文件將使用模擬模式，無法連接到後端 AI 分析服務，無法執行真實的股票分析。

## 📝 詳細使用步驟

### 步驟 1：啟動服務器

```bash
cd web
python3 server.py
```

等待看到啟動成功訊息。

### 步驟 2：打開瀏覽器

訪問 `http://localhost:8000`

您應該會看到：
- ✅ 頂部顯示 "FinGenius 台股分析平台"
- ✅ 右上角顯示 "已連接到分析服務器"（綠色提示）

### 步驟 3：輸入股票代碼

1. 在「股票代碼」輸入框中輸入台股代碼（如：`2330`）
2. 系統會自動驗證格式（4-6位數字）
3. 點擊「驗證」按鈕
4. 系統顯示股票基本資訊（名稱、產業）

### 步驟 4：開始分析

1. 確認股票資訊無誤後，點擊「開始分析」按鈕
2. 頁面自動跳轉到「AI 分析進度」區域
3. 觀察 6 位 AI 專家的分析進度：
   - 💬 輿情分析
   - 🛡️ 風險評估
   - 👥 三大法人
   - 📈 技術分析
   - 🎲 籌碼分析
   - 💰 大額交易

### 步驟 5：等待分析完成

完整分析通常需要 **2-5 分鐘**：
- **Research 階段**：約 1-2 分鐘
- **Battle 階段**：約 1-2 分鐘
- **Report 生成**：約 30 秒

進度條會顯示當前執行的階段和進度百分比。

### 步驟 6：查看分析結果

分析完成後，頁面自動跳轉到「分析結果」區域。

**切換標籤頁查看不同維度的分析**：
1. 點擊「總覽」查看整體評估
2. 點擊「技術分析」查看圖表
3. 點擊「辯論結果」查看 AI 專家的最終決策

**重點關注「辯論結果」標籤**：
- 查看最終決策（看多/看空）
- 查看投票統計（各選項票數）
- 了解專家的核心論點

## 🛠️ 技術架構

### 前端技術
- **HTML5 + Bootstrap 5**：響應式界面設計
- **Chart.js**：數據可視化與圖表展示
- **WebSocket API**：實時雙向通信

### 後端技術
- **FastAPI**：高性能 Web 框架
- **WebSocket**：實時進度推送
- **ResearchEnvironment**：研究階段引擎
- **BattleEnvironment**：辯論階段引擎
- **ReportAgent**：報告生成引擎

### 通信流程

```
瀏覽器前端
    ↕️ WebSocket
FastAPI Server
    ↕️ 調用
ResearchEnvironment (6 位 AI 專家)
    ↓
BattleEnvironment (辯論投票)
    ↓
ReportAgent (報告生成)
    ↕️ 返回
瀏覽器顯示結果
```

## 🎨 優化特性

### 1. 智能錯誤處理
- WebSocket 連接失敗時自動切換到模擬模式
- 分析失敗時提供重試選項
- 友好的錯誤提示訊息
- 異常情況自動恢復

### 2. 用戶體驗提升
- 即時輸入驗證與反饋
- 進度條與狀態指示器
- 可取消正在進行的分析
- Toast 通知提醒
- 載入動畫效果

### 3. 數據驗證
- 前端格式驗證（4-6位數字）
- 後端股票代碼合法性驗證
- 雙重保障確保數據正確性
- 防止無效請求

### 4. 性能優化
- WebSocket 長連接，減少開銷
- 異步處理，不阻塞界面
- 結果快取，加速重複查詢
- 按需載入，減少初始載入時間

## ❓ 常見問題

### Q1: 無法連接到服務器？

**症狀**：瀏覽器顯示「使用模擬模式」或無法連接

**解決方法**：
1. 確保已啟動 `server.py`
2. 檢查終端是否有錯誤訊息
3. 確認端口 8000 未被其他程序占用
   ```bash
   lsof -i :8000
   ```
4. 嘗試使用 `127.0.0.1:8000` 而非 `localhost:8000`
5. 檢查防火牆設置

### Q2: 顯示「使用模擬模式」？

**原因**：WebSocket 連接失敗，系統自動切換到模擬模式

**影響**：無法執行真實的 AI 分析，只能看到示範數據

**解決方法**：
1. 重新啟動服務器
2. 刷新瀏覽器頁面（Ctrl+R 或 Cmd+R）
3. 清除瀏覽器快取
4. 檢查控制台錯誤訊息（F12 開發者工具）

### Q3: 分析時間過長？

**正常時間**：完整分析需要 2-5 分鐘

**如果超過 10 分鐘**：
1. 點擊「取消分析」按鈕
2. 檢查網絡連接
3. 查看終端是否有錯誤
4. 確認 API Key 配置正確
5. 重新啟動服務器並重試

### Q4: 找不到股票代碼？

**常見原因**：
- 輸入的不是有效的台股代碼
- 股票已下市或停牌
- 代碼格式錯誤（應為4-6位數字）

**解決方法**：
1. 確認輸入的是正確的台股代碼
2. 檢查代碼格式（純數字，無空格）
3. 嘗試其他常見股票代碼測試

### Q5: 辯論結果顯示空白？

**原因**：Battle 階段尚未實現或執行失敗

**檢查方法**：
1. 查看「總覽」標籤是否有數據
2. 檢查終端是否有錯誤訊息
3. 確認 `web/server.py` 包含 Battle 階段代碼

### Q6: 報告保存在哪裡？

**保存位置**：專案根目錄的 `report/` 資料夾

**目錄結構**：
```
report/
├── html/           # HTML 美化報告
├── debate/         # 辯論記錄 JSON
└── vote/           # 投票結果 JSON
```

**檔案命名**：`report_<股票代碼>_<時間戳>.html`

**查看報告**：
```bash
# 列出所有報告
ls -la report/html/

# 在瀏覽器中打開最新報告
open report/html/$(ls -t report/html/ | head -1)
```

### Q7: 如何自訂分析參數？

**預設參數**：
- `max_steps`: 3（每個 Agent 最大執行步數）
- `debate_rounds`: 2（辯論輪數）

**修改方法**：
編輯 `web/server.py` 的 `handle_analysis_request` 方法：

```python
async def handle_analysis_request(self, websocket: WebSocket, message: Dict[str, Any]):
    stock_code = message.get('stock_code', '')
    max_steps = message.get('max_steps', 5)      # 改為 5
    debate_rounds = message.get('debate_rounds', 3)  # 改為 3
    # ...
```

**注意**：增加步數和輪數會延長分析時間和增加 API 費用。

## 🐛 開發與調試

### 查看控制台日誌

在瀏覽器中按 **F12** 打開開發者工具，切換到 **Console** 標籤：

**正常日誌**：
```
WebSocket 連接已建立
收到 WebSocket 消息: {type: 'validation_result', ...}
收到 WebSocket 消息: {type: 'analysis_started', ...}
```

**錯誤日誌**：
```
WebSocket 錯誤: Error: Connection refused
無法建立 WebSocket 連接
```

### 查看服務器日誌

`server.py` 會在終端輸出詳細的運行日誌：

**正常日誌**：
```
INFO:     Uvicorn running on http://localhost:8000
客戶端 client_xxx 已連接
收到來自 client_xxx 的消息: start_analysis
開始 Research 階段: 2330
```

**錯誤日誌**：
```
ERROR: Research 階段錯誤: ...
ERROR: 分析請求處理錯誤: ...
```

### 調試技巧

1. **檢查 WebSocket 狀態**：
   ```javascript
   console.log(app.websocket.readyState);
   // 0: CONNECTING, 1: OPEN, 2: CLOSING, 3: CLOSED
   ```

2. **手動發送測試消息**：
   ```javascript
   app.websocket.send(JSON.stringify({
       type: 'validate_stock',
       stock_code: '2330'
   }));
   ```

3. **查看網絡請求**：
   開發者工具 → Network 標籤 → 篩選 WS（WebSocket）

## 🚀 未來改進計劃

### 計劃中的功能
- [ ] 添加歷史分析記錄查詢
- [ ] 支持多股票對比分析
- [ ] 增加自定義分析參數介面
- [ ] 提供 PDF 報告下載
- [ ] 添加即時股價更新
- [ ] 支持使用者帳號系統
- [ ] 移動端響應式優化
- [ ] 報告分享與導出功能
- [ ] 多語言支持（English/繁體中文/简体中文）

### 性能優化計劃
- [ ] 實現分析結果快取
- [ ] 優化 WebSocket 重連機制
- [ ] 減少 API 調用次數
- [ ] 前端資源懶載入
- [ ] 壓縮報告檔案大小

## 📞 需要幫助？

如果您遇到任何問題：

1. **查看本文檔的常見問題章節**
2. **檢查 GitHub Issues**：https://github.com/huayaoyuanjin/FinGenius/issues
3. **提交新 Issue**：詳細描述問題、截圖、錯誤訊息
4. **聯繫開發團隊**：support@fingenius.cn

## ⚠️ 免責聲明

本平台僅供研究與教學用途，所有輸出均為 AI 推演結果，**不構成任何投資建議**。

**投資有風險，決策需謹慎。**

使用本平台產生的任何投資損失，開發者不承擔責任。

---

**祝您使用愉快！** 🎉
